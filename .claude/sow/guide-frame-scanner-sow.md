# ガイド領域式QRスキャナー Statement of Work (SOW)
## カード配置ガイドによるQRコード認識機能拡張

### 1. プロジェクト概要

#### 1.1 目的
既存のQRコードスキャナーに、カード比率（252:352）のガイド領域を追加し、ユーザーが正確にカードを配置してQRコードをスキャンできる機能を実装する。

#### 1.2 背景
- 複数QRコードが印刷されたカードの使用シーン増加
- カメラとカードの距離・角度の標準化が必要
- 視覚的ガイドによるユーザビリティ向上の要求
- 既存の重複排除・リスト管理機能は維持

#### 1.3 スコープ
- ガイド領域の表示と状態管理
- 領域内QRコード優先認識
- 視覚的フィードバックの実装
- レスポンシブ対応

### 2. 機能要件

#### 2.1 ガイド領域表示
- **寸法比率**: 252:352（幅:高さ）厳密に維持
- **サイズ**: 画面サイズの60%を基準に自動調整
- **配置**: 画面中央に固定配置
- **デザイン要素**:
  - 半透明の枠線（opacity: 0.5）
  - コーナーマーカー（L字型、20px）
  - 中央に説明テキスト表示

#### 2.2 状態表示
| 状態 | 枠線色 | アニメーション | 説明テキスト |
|------|--------|---------------|-------------|
| 待機中 | 白色 | 点滅（1秒周期） | "カードをここに合わせる" |
| スキャン中 | 黄色 | パルス効果 | "スキャン中..." |
| 認識成功 | 緑色 | フラッシュ（0.3秒） | "認識しました！" |
| エラー | 赤色 | 震動効果 | "認識できません" |

#### 2.3 認識処理
- ガイド領域内のQRコードを優先処理
- 領域外のQRコードも認識可能（優先度低）
- 既存の重複排除ロジックを維持
- 認識したQRコードは個別にリストへ追加

### 3. 技術仕様

#### 3.1 レスポンシブ設計
```typescript
interface GuideFrameConfig {
  baseRatio: { width: 252, height: 352 }
  screenCoverage: 0.6  // 画面の60%使用
  minWidth: 200        // 最小幅ピクセル
  maxWidth: 400        // 最大幅ピクセル
  padding: 20          // 画面端からの余白
}

// デバイス別対応
- iPhone SE: 200 x 279px
- iPhone 14: 250 x 349px
- iPad: 400 x 559px（最大サイズ）
```

#### 3.2 座標系と判定ロジック
```typescript
interface GuideRegion {
  top: number
  left: number
  width: number
  height: number
  center: { x: number, y: number }
}

// QRコード位置判定
function isQRInGuide(qr: QRResult, guide: GuideRegion): boolean {
  // 中心点ベースの判定（許容誤差10%）
  const tolerance = guide.width * 0.1
  return (
    qr.center.x >= guide.left - tolerance &&
    qr.center.x <= guide.left + guide.width + tolerance &&
    qr.center.y >= guide.top - tolerance &&
    qr.center.y <= guide.top + guide.height + tolerance
  )
}
```

#### 3.3 視覚効果実装
```css
/* ガイド枠基本スタイル */
.guide-frame {
  position: absolute;
  border: 2px dashed rgba(255, 255, 255, 0.5);
  pointer-events: none;
  transition: all 0.3s ease;
}

/* コーナーマーカー */
.corner-marker {
  position: absolute;
  width: 20px;
  height: 20px;
  border: 3px solid white;
}

.corner-tl {
  top: -2px;
  left: -2px;
  border-right: none;
  border-bottom: none;
}

/* 状態別アニメーション */
@keyframes pulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

@keyframes flash {
  0%, 100% { background: transparent; }
  50% { background: rgba(76, 175, 80, 0.3); }
}
```

### 4. 実装フロー

#### 4.1 Phase 1: 基本実装（2時間）
1. ガイド領域コンポーネント作成
2. レスポンシブサイズ計算ロジック
3. 基本的な表示とスタイリング

#### 4.2 Phase 2: 認識統合（1.5時間）
1. 領域内判定ロジック実装
2. 既存スキャン処理との統合
3. 優先度付き認識処理

#### 4.3 Phase 3: UX向上（1時間）
1. 状態遷移アニメーション
2. 視覚的フィードバック実装
3. エラーハンドリング

#### 4.4 Phase 4: テスト・調整（30分）
1. 各デバイスでの表示確認
2. 認識精度の調整
3. パフォーマンス最適化

### 5. パフォーマンス目標

| 指標 | 目標値 | 備考 |
|------|--------|------|
| ガイド表示遅延 | < 100ms | 初期レンダリング |
| サイズ再計算 | < 50ms | 画面回転時 |
| 領域内判定 | < 5ms | フレームごと |
| メモリ追加使用量 | < 5MB | ガイド要素分 |

### 6. テスト計画

#### 6.1 機能テスト
- [ ] ガイド領域が正しい比率で表示
- [ ] 画面サイズ変更時の自動調整
- [ ] 領域内QRコードの優先認識
- [ ] 状態遷移アニメーション動作
- [ ] 既存機能との互換性

#### 6.2 デバイステスト
- [ ] iPhone SE（小画面）
- [ ] iPhone 14 Pro（標準）
- [ ] iPad（大画面）
- [ ] 縦向き/横向き切り替え

#### 6.3 ユーザビリティテスト
- [ ] カード配置の容易さ
- [ ] 視覚的フィードバックの明確さ
- [ ] エラー時の対処法理解

### 7. リスク管理

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 画面サイズ多様性 | 高 | 最小/最大サイズ制限設定 |
| カメラ解像度差異 | 中 | 座標正規化処理 |
| 処理負荷増加 | 低 | 領域限定処理オプション |
| iOS Safari座標系 | 中 | デバイス固有の調整値適用 |

### 8. 成功基準

- ✅ カード比率252:352のガイド表示
- ✅ 全対象デバイスでの適切な表示
- ✅ 領域内QRコードの優先認識動作
- ✅ 直感的な視覚フィードバック
- ✅ 既存機能への影響なし
- ✅ 30FPSでの安定動作維持

### 9. 将来の拡張可能性

- **複数ガイドサイズ**: 異なるカード規格対応
- **自動カード検出**: エッジ検出による自動位置合わせ
- **撮影モード**: ガイド内の画像キャプチャ
- **AR表示**: カード情報のオーバーレイ表示
- **バッチスキャン**: 複数カードの連続認識

### 10. 納品物

1. **ソースコード更新**
   - App.tsx（ガイド領域統合）
   - App.css（スタイリング追加）
   - GuideFrame.tsx（新規コンポーネント）

2. **ドキュメント**
   - 実装詳細説明
   - 使用方法ガイド
   - トラブルシューティング

3. **テスト結果**
   - デバイス別動作確認表
   - パフォーマンス測定結果

---

**Document Version**: 1.0.0
**Last Updated**: 2025-09-15
**Author**: Development Team
**Status**: Approved for Implementation
**Estimated Hours**: 5時間